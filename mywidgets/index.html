<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>

<head>
    <title>Range selector</title>

    <script type="text/javascript" src="../d3/d3.js"></script>
    <script type="text/javascript" src="../d3/d3.time.js"></script>

    <script type="text/javascript" src="selector.js"></script>
    <script type="text/javascript" src="context.js"></script>
    <script type="text/javascript" src="data.js"></script>
    <script type="text/javascript" src="focus.js"></script>

    <style type="text/css">

        .diagram {
            fill: none;
        }

        .selection {
            stroke: green;
            stroke-opacity: 0.3;
            fill: green;
            fill-opacity: 0.1;
        }

        .limit {
            stroke: none;
            fill: green;
        }

        .axis, .xtick, .xlabel, .ytick, .ylabel {
            stroke: black;
        }

        .xlabel {
            font-family: Arial;
            font-size: 9pt;
        }

        .focus .plot {
            stroke: red;
        }

        .context .plot {
            stroke: blue;
            stroke-width: 2;
        }
    </style>
</head>
<body>

    <ul>
        <li>You can drag the triangles to modify the selection</li>
        <li>You can drag the selected area if there's room</li>
    </ul>

    <div id="selector"></div>
    <div id="range"></div>

    <script type="text/javascript">

        function format(num, digits, decimals) {
            var str = num.toFixed(decimals);
            while (str.length < digits+decimals+1) {
                str = "0" + str;
            }
            return str;
        }

        var fx = 20, fy = 30, fw = 500, fh = 400;
        var cx = fx, cy = fy+fh, cw = fw, ch = 0.2*fh;
        var sx = fx + 20, sy = cy + 5, sw = cw-40, sh = ch-5;

        var diagram = d3.select("#selector").append("svg")
                        .attr("class", "diagram")
                        .attr("width", fx+fw)
                        .attr("height", fy+fh+ch+10);

        var data = create_time_series(1);

        var focus = make_focus(diagram, fx, fy, fw, fh, {});

        var context = make_context(diagram, cx, cy, cw, ch, {
            top: 5,
            data: data
        });

        var selector = make_selector(diagram, sx, sy, sw, sh, {
            b: 10,
            range: d3.extent(data, function (d) { return d.x; }),
            callback: function (l, r) {

                var focus_data = data.filter(function (d) {
                    return l <= d.x && d.x <= r;
                });

                focus.update(focus_data);

                var format = d3.time.format("%m-%Y");
                d3.select("#range").text(format(new Date(l)) + " " + format(new Date(r)));
            }
        });

    </script>

</body>
</html>